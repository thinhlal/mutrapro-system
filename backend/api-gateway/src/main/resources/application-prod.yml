server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: api-gateway
  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}
  cloud:
    gateway:
      server:
        webflux:
          default-filters:
            - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
          routes:
            # Identity Service
            - id: identity-service
              uri: ${IDENTITY_URI:http://identity-service:8081}
              predicates:
                - Path=${app.api-prefix}/identity/**
              filters:
                - StripPrefix=3

            # Project Service (handles contracts, tasks, files, and studio bookings)
            - id: project-service
              uri: ${PROJECT_URI:http://project-service:8082}
              predicates:
                - Path=${app.api-prefix}/projects/**
              filters:
                - StripPrefix=3

            # Request Service
            - id: request-service
              uri: ${REQUEST_URI:http://request-service:8084}
              predicates:
                - Path=${app.api-prefix}/requests/**
              filters:
                - StripPrefix=3

            # Billing Service
            - id: billing-service
              uri: ${BILLING_URI:http://billing-service:8083}
              predicates:
                - Path=${app.api-prefix}/billing/**
              filters:
                - StripPrefix=3

            # Specialist Service
            - id: specialist-service
              uri: ${SPECIALIST_URI:http://specialist-service:8086}
              predicates:
                - Path=${app.api-prefix}/specialists/**
              filters:
                - StripPrefix=3

            # Notification Service
            - id: notification-service
              uri: ${NOTIFICATION_URI:http://notification-service:8085}
              predicates:
                - Path=${app.api-prefix}/notifications/**
              filters:
                - StripPrefix=3

            # Chat Service
            - id: chat-service
              uri: ${CHAT_URI:http://chat-service:8088}
              predicates:
                - Path=${app.api-prefix}/chat/**
              filters:
                - StripPrefix=3

app:
  api-prefix: ${API_PREFIX:/api/v1}
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:https://www.mutrapro.top,https://mutrapro.top,http://localhost:5173,http://127.0.0.1:5173}

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway,prometheus
  metrics:
    tags:
      application: ${spring.application.name}
  prometheus:
    metrics:
      export:
        enabled: true

jwt:
  signerKey: ${JWT_SIGNER_KEY:QVHfEyXEd7KG4eUfYAWOUvuPjlufU3vImJ0MEialEhHoQPjB6wZTL6Ma9XLnKaYn}
